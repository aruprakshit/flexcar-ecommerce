<div class="card">
  <% if item.promotions.active.any? %>
    <div class="card-image">
      <div class="image is-4by3 has-background-light">
        <div class="is-flex is-align-items-center is-justify-content-center" style="height: 100%;">
          <i class="fas fa-image fa-3x has-text-grey"></i>
        </div>
        <div class="tag is-danger is-overlay" style="top: 0.5rem; right: 0.5rem;">Sale!</div>
      </div>
    </div>
  <% else %>
    <div class="card-image">
      <div class="image is-4by3 has-background-light">
        <div class="is-flex is-align-items-center is-justify-content-center" style="height: 100%;">
          <i class="fas fa-image fa-3x has-text-grey"></i>
        </div>
      </div>
    </div>
  <% end %>

  <div class="card-content">
    <h4 class="title is-5"><%= item.name %></h4>
    <p class="subtitle is-6 has-text-grey">
      <%= truncate(item.description, length: 80) %>
    </p>
    
    <div class="tags has-addons mb-3">
      <span class="tag is-light">
        <i class="fas fa-tag"></i> <%= item.category.name %>
      </span>
      <span class="tag is-light">
        <i class="fas fa-star"></i> <%= item.brand.name %>
      </span>
    </div>

    <div class="level">
      <div class="level-left">
        <div class="level-item">
          <div>
            <% if item.promotions.active.any? %>
              <span class="has-text-grey-light has-text-decoration-line-through">$<%= item.price %></span>
              <span class="has-text-danger has-text-weight-bold">$<%= calculate_discounted_price(item) %></span>
            <% else %>
              <span class="has-text-weight-bold">$<%= item.price %></span>
            <% end %>
            <small class="has-text-grey">/<%= item.sale_type == 'by_weight' ? 'lb' : 'each' %></small>
          </div>
        </div>
      </div>
    </div>
    
    <%= form_with url: cart_add_item_path, method: :post, local: true do |form| %>
      <%= form.hidden_field :item_id, value: item.id %>
      <div class="field has-addons">
        <div class="control">
          <%= form.number_field :quantity, value: 1, min: 1, class: "input", style: "width: 80px;" %>
        </div>
        <div class="control">
          <%= form.submit "Add", class: "button is-primary" %>
        </div>
      </div>
    <% end %>
  </div>
</div>